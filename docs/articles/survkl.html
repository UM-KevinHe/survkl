<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>survkl: Transfer-Learning Based Integrated Cox Models • survkl</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="survkl: Transfer-Learning Based Integrated Cox Models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">survkl</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/survkl.html">Get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-appendix" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Appendix</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-appendix">
<li><a class="dropdown-item" href="../articles/Methods.html">Methods</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/UM-KevinHe/survkl" aria-label="GitHub repository"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>survkl: Transfer-Learning Based Integrated Cox Models</h1>
            
      

      <div class="d-none name"><code>survkl.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Accurate prognosis prediction plays a central role in survival
analysis. The recent growth of large-scale biobank studies—characterized
by extensive genetic, transcriptomic, imaging, and electronic health
record data—has created new opportunities to enhance prediction
accuracy. However, despite their potential, these datasets often suffer
from limited effective sample sizes, high dimensionality, low
signal-to-noise ratios, and practical constraints such as patient
privacy.</p>
<p>Integrating external information is a promising strategy for
improving model performance, yet classical data integration methods
typically assume homogeneous data-generating mechanisms across sources.
This assumption rarely holds in modern biomedical applications. Ignoring
heterogeneity can introduce substantial bias, underscoring the need for
transfer-learning approaches that explicitly account for discrepancies
across populations.</p>
<p>While KL divergence has been used previously for integrating
binary-outcome models, extending such ideas to censored time-to-event
outcomes is nontrivial due to censoring and the limited nature of
available external survival information (e.g., predicted risk scores or
sets of coefficients without a baseline hazard).</p>
<p>The <code>survkl</code> package addresses these challenges by
offering a transfer-learning framework for Cox models that integrates
external information with newly collected survival data. It is designed
to be flexible, privacy-preserving, and effective across both low- and
high-dimensional settings. Key features include:</p>
<div class="section level3">
<h3 id="key-features">
<strong>Key Features</strong><a class="anchor" aria-label="anchor" href="#key-features"></a>
</h3>
<ul>
<li><p><strong>Transfer Learning with KL Integration:</strong><br>
Incorporates various types of external information via KL-based
penalization to adaptively borrow strength.</p></li>
<li><p><strong>Privacy-Preserving External Use:</strong><br>
Requires only summary-level external inputs—such as risk scores or
coefficient estimates—without access to individual-level external
data.</p></li>
<li><p><strong>Robustness to Heterogeneity:</strong><br>
Explicitly accounts for population differences through adaptive
weighting controlled by tuning parameters (<code>eta</code>), enabling
selective borrowing from compatible sources.</p></li>
<li>
<p><strong>High-Dimensional Modeling Support:</strong><br>
Implements regularized KL-integrated Cox models, including</p>
<ul>
<li>Ridge (<code>coxkl_ridge</code>)<br>
</li>
<li>Elastic Net (<code>coxkl_enet</code>, including LASSO as a special
case)</li>
</ul>
</li>
<li><p><strong>Flexible External Information Formats:</strong><br>
Supports external coefficients, risk scores, and partially overlapping
predictor sets.</p></li>
<li>
<p><strong>Comprehensive Cross-Validation Framework:</strong><br>
Provides multiple tuning criteria including</p>
<ul>
<li>
<em>Two based on C-index</em><br>
</li>
<li>
<em>Two based on Loss</em>: predicted deviance and <strong>V&amp;VH
loss</strong>.</li>
</ul>
</li>
</ul>
<p>This vignette introduces the main functionalities of
<code>survkl</code> and provides examples for both low- and
high-dimensional modeling workflows.</p>
</div>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"survkl"</span><span class="op">)</span></span></code></pre></div>
<p>Or install the development version of <code>survkl</code> from
GitHub:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"UM-KevinHe/survkl"</span>, ref <span class="op">=</span> <span class="st">"main"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="quick-start">Quick Start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<p>This section provides a brief overview of the main functions using
example datasets included in the package.</p>
<p>First, load the package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://umkevinhe.github.io/survkl">survkl</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="low-dimensional-integration">Low-Dimensional Integration<a class="anchor" aria-label="anchor" href="#low-dimensional-integration"></a>
</h3>
<p>The low-dimensional KL-integrated Cox model, implemented in
<code>coxkl</code>, is designed for settings where the number of
predictors is modest. The method incorporates external
information—either in the form of external Cox coefficients
(<code>beta</code>) or pre-computed external risk scores
(<code>RS</code>)—using a KL-based penalization. The tuning parameter
<code>eta</code> governs the degree of borrowing:<br>
- <code>eta = 0</code> reproduces the standard Cox model;<br>
- larger <code>eta</code> values increasingly pull the fitted
coefficients toward the external information.</p>
<p>In this section we demonstrate how to fit a KL-integrated Cox model
and how to select the optimal <code>eta</code> using cross-validation
via <code>cv.coxkl</code>.</p>
<div class="section level4">
<h4 id="example-data-structure">Example data structure<a class="anchor" aria-label="anchor" href="#example-data-structure"></a>
</h4>
<p>We illustrate the workflow using the built-in low-dimensional
simulated dataset:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ExampleData_lowdim</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train</span>  <span class="op">&lt;-</span> <span class="va">ExampleData_lowdim</span><span class="op">$</span><span class="va">train</span></span>
<span><span class="va">z</span>      <span class="op">&lt;-</span> <span class="va">train</span><span class="op">$</span><span class="va">z</span></span>
<span><span class="va">delta</span>  <span class="op">&lt;-</span> <span class="va">train</span><span class="op">$</span><span class="va">status</span></span>
<span><span class="va">time</span>   <span class="op">&lt;-</span> <span class="va">train</span><span class="op">$</span><span class="va">time</span></span>
<span><span class="va">strat</span>  <span class="op">&lt;-</span> <span class="va">train</span><span class="op">$</span><span class="va">stratum</span></span></code></pre></div>
<p>and externally derived coefficients beta_external:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta_ext</span> <span class="op">&lt;-</span> <span class="va">ExampleData_lowdim</span><span class="op">$</span><span class="va">beta_external_good</span></span></code></pre></div>
<p>We generate a sequence of eta values through the internal utility
<code><a href="../reference/generate_eta.html">generate_eta()</a></code>, and fit the KL-integrated model across this
grid:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eta_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_eta.html">generate_eta</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"exponential"</span>, n <span class="op">=</span> <span class="fl">10</span>, max_eta <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">fit_lowdim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coxkl.html">coxkl</a></span><span class="op">(</span></span>
<span>  z <span class="op">=</span> <span class="va">z</span>,</span>
<span>  delta <span class="op">=</span> <span class="va">delta</span>,</span>
<span>  time <span class="op">=</span> <span class="va">time</span>,</span>
<span>  stratum <span class="op">=</span> <span class="va">strat</span>,</span>
<span>  beta <span class="op">=</span> <span class="va">beta_ext</span>,</span>
<span>  etas <span class="op">=</span> <span class="va">eta_grid</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The S3 method <code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef()</a></code> provides a clean interface to
extract estimated coefficients. If the requested η is between fitted
values, linear interpolation is performed:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_lowdim</span>, eta <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Linear interpolation performed between eta = 0.900 and eta = 1.839 for</span></span>
<span><span class="co">## eta = 1.000.</span></span></code></pre>
<pre><code><span><span class="co">##                1</span></span>
<span><span class="co">## [1,]  0.25032320</span></span>
<span><span class="co">## [2,] -0.39703180</span></span>
<span><span class="co">## [3,]  0.08661859</span></span>
<span><span class="co">## [4,] -0.58832784</span></span>
<span><span class="co">## [5,]  0.29433864</span></span>
<span><span class="co">## [6,] -0.55791424</span></span></code></pre>
<p>Users may instead supply an external risk score vector:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RS_ext</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">beta_ext</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_lowdim_RS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coxkl.html">coxkl</a></span><span class="op">(</span></span>
<span>  z <span class="op">=</span> <span class="va">z</span>,</span>
<span>  delta <span class="op">=</span> <span class="va">delta</span>,</span>
<span>  time <span class="op">=</span> <span class="va">time</span>,</span>
<span>  stratum <span class="op">=</span> <span class="va">strat</span>,</span>
<span>  RS <span class="op">=</span> <span class="va">RS_ext</span>,</span>
<span>  etas <span class="op">=</span> <span class="va">eta_grid</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_lowdim_RS</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1]  0.25982263 -0.49599768 -0.01972113 -0.84023506  0.24808718 -0.78551866</span></span>
<span><span class="co">##  [7]  0.25455640 -0.44210371  0.03600659 -0.70926840</span></span></code></pre>
<p>Objects of class <code>coxkl</code> can be visualized using the S3
plotting method <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>.<br>
This function displays how model performance changes across the
η–sequence used during fitting.</p>
<p>Two types of performance criteria are supported:</p>
<ul>
<li><p><code>"loss"</code><br>
(default; −2 × partial log-likelihood, normalized by sample
size)</p></li>
<li><p><code>"CIndex"</code><br>
(stratified concordance index)</p></li>
</ul>
<p>If no test data are supplied, performance is computed using the
training data stored in <code>object$data</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit_lowdim</span><span class="op">)</span>    </span></code></pre></div>
<pre><code><span><span class="co">## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">survkl</span> package.</span></span>
<span><span class="co">##   Please report the issue to the authors.</span></span>
<span><span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">## <span style="color: #555555;">generated.</span></span></span></code></pre>
<p><img src="survkl_files/figure-html/unnamed-chunk-10-1.png" class="r-plt" alt="Plot generated in survkl vignette" width="700"></p>
<p>The function <code>cv.coxkl</code> performs K-fold (default 5)
cross-validation to choose the integration parameter. It supports four
criteria:</p>
<ul>
<li>
<code>"V&amp;VH"</code> — V&amp;VH loss<br>
</li>
<li>
<code>"LinPred"</code> — predicted partial deviance<br>
</li>
<li>
<code>"CIndex_pooled"</code> — pooled comparable pairs<br>
</li>
<li>
<code>"CIndex_foldaverage"</code> — per-fold stratified C-index</li>
</ul>
<p>Below is an example using the default <code>"V&amp;VH"</code>
criterion:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cv_lowdim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv.coxkl.html">cv.coxkl</a></span><span class="op">(</span></span>
<span>  z        <span class="op">=</span> <span class="va">z</span>,</span>
<span>  delta    <span class="op">=</span> <span class="va">delta</span>,</span>
<span>  time     <span class="op">=</span> <span class="va">time</span>,</span>
<span>  stratum  <span class="op">=</span> <span class="va">strat</span>,</span>
<span>  beta     <span class="op">=</span> <span class="va">beta_ext</span>,</span>
<span>  etas     <span class="op">=</span> <span class="va">eta_grid</span>,</span>
<span>  nfolds   <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  criteria <span class="op">=</span> <span class="st">"V&amp;VH"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The cross-validated performance curve can be visualized using
cv.plot():</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cv.plot.html">cv.plot</a></span><span class="op">(</span><span class="va">cv_lowdim</span><span class="op">)</span></span></code></pre></div>
<p><img src="survkl_files/figure-html/unnamed-chunk-12-1.png" class="r-plt" alt="Plot generated in survkl vignette" width="700"></p>
<p>The solid purple curve shows cross-validated loss as a function of η
(lower values indicate better predictive performance). The green dotted
horizontal line represents the internal baseline, corresponding to η = 0
(the model that does not borrow any external information). This
visualization makes it easy to assess whether external information
improves prediction. If the purple curve drops below the green line,
then borrowing external information (i.e., using η &gt; 0) leads to
better predictive performance.</p>
</div>
</div>
<div class="section level3">
<h3 id="high-dimensional-integration-ridge-elastic-net-and-lasso">High-Dimensional Integration (Ridge, Elastic Net, and LASSO)<a class="anchor" aria-label="anchor" href="#high-dimensional-integration-ridge-elastic-net-and-lasso"></a>
</h3>
<p>In high-dimensional settings (for example, when the number of
predictors is comparable to or exceeds the sample size), the
<code>survkl</code> package extends KL-integrated Cox modeling with
regularization. Two families of penalties are supported:</p>
<ul>
<li>Ridge penalty (L2), implemented in <code>coxkl_ridge</code>, which
shrinks all coefficients toward zero while retaining dense
solutions.</li>
<li>Elastic net penalty (a mixture of L1 and L2), implemented in
<code>coxkl_enet</code>, which includes the LASSO (pure L1) as a special
case when the mixing parameter is set to 1.</li>
</ul>
<p>Both models combine:</p>
<ul>
<li>a KL term, controlled by the integration parameter <code>eta</code>,
to borrow information from external sources (risk scores <code>RS</code>
or coefficients <code>beta</code>), and<br>
</li>
<li>a regularization term (ridge or elastic net) to stabilize estimation
in high-dimensional designs.</li>
</ul>
<p>In this section we first introduce the shared high-dimensional
example dataset, and then illustrate the usage of the ridge-penalized
model <code>coxkl_ridge</code>. (The elastic net workflows are analogous
and will be discussed in a separate subsection.)</p>
<div class="section level4">
<h4 id="high-dimensional-example-data">High-dimensional example data<a class="anchor" aria-label="anchor" href="#high-dimensional-example-data"></a>
</h4>
<p>We use the built-in high-dimensional simulated dataset:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ExampleData_highdim</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train_hd</span>  <span class="op">&lt;-</span> <span class="va">ExampleData_highdim</span><span class="op">$</span><span class="va">train</span></span>
<span><span class="va">test_hd</span>   <span class="op">&lt;-</span> <span class="va">ExampleData_highdim</span><span class="op">$</span><span class="va">test</span></span>
<span></span>
<span><span class="va">z_hd</span>      <span class="op">&lt;-</span> <span class="va">train_hd</span><span class="op">$</span><span class="va">z</span></span>
<span><span class="va">delta_hd</span>  <span class="op">&lt;-</span> <span class="va">train_hd</span><span class="op">$</span><span class="va">status</span></span>
<span><span class="va">time_hd</span>   <span class="op">&lt;-</span> <span class="va">train_hd</span><span class="op">$</span><span class="va">time</span></span>
<span><span class="va">strat_hd</span>  <span class="op">&lt;-</span> <span class="va">train_hd</span><span class="op">$</span><span class="va">stratum</span></span></code></pre></div>
<p>This dataset contains 50 predictors
(<code>Z1</code>–<code>Z50</code>) with 6 signal variables and 44 AR(1)
noise variables. Externally derived coefficients are provided in
<code>beta_external</code>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta_external_hd</span> <span class="op">&lt;-</span> <span class="va">ExampleData_highdim</span><span class="op">$</span><span class="va">beta_external</span></span>
<span><span class="va">beta_external_hd</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##         Z1         Z2         Z3         Z4         Z5         Z6         Z7 </span></span>
<span><span class="co">##  0.3045000 -0.2823218  0.3324814 -0.2399085  0.2909258 -0.2894610  0.0000000 </span></span>
<span><span class="co">##         Z8         Z9        Z10 </span></span>
<span><span class="co">##  0.0000000  0.0000000  0.0000000</span></span></code></pre>
<p>These external coefficients are estimated from a separate dataset
using only <code>Z1</code>–<code>Z6</code> and then expanded to a
length-50 vector, with zeros for <code>Z7</code>–<code>Z50</code>.</p>
</div>
<div class="section level4">
<h4 id="ridge-penalized-kl-integrated-cox-model-coxkl_ridge">Ridge-Penalized KL-Integrated Cox Model
(<code>coxkl_ridge</code>)<a class="anchor" aria-label="anchor" href="#ridge-penalized-kl-integrated-cox-model-coxkl_ridge"></a>
</h4>
<p>The function <code>coxkl_ridge</code> fits a KL-integrated Cox model
with a ridge (L2) penalty on all predictors. External information is
incorporated through a KL term weighted by <code>eta</code>, while the
ridge penalty is controlled by a sequence of tuning parameters
<code>lambda</code>. If <code>lambda</code> is not provided, a
decreasing lambda path is generated automatically.</p>
<p>We first fit a KL–ridge model for a fixed integration weight
<code>eta</code> and an automatically generated lambda path:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_ridge</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coxkl_ridge.html">coxkl_ridge</a></span><span class="op">(</span></span>
<span>  z        <span class="op">=</span> <span class="va">z_hd</span>,</span>
<span>  delta    <span class="op">=</span> <span class="va">delta_hd</span>,</span>
<span>  time     <span class="op">=</span> <span class="va">time_hd</span>,</span>
<span>  stratum  <span class="op">=</span> <span class="va">strat_hd</span>,</span>
<span>  RS       <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  beta     <span class="op">=</span> <span class="va">beta_external_hd</span>,   <span class="co"># external coefficients (length 50)</span></span>
<span>  eta      <span class="op">=</span> <span class="fl">1</span>,                  <span class="co"># KL integration weight</span></span>
<span>  lambda   <span class="op">=</span> <span class="cn">NULL</span>,               <span class="co"># automatically generate a lambda sequence</span></span>
<span>  message  <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The fitted object stores, for each lambda value:</p>
<ul>
<li>
<code>model_ridge$lambda</code> — the lambda sequence (in decreasing
order),</li>
<li>
<code>model_ridge$beta</code> — estimated coefficients (one column
per lambda),</li>
<li>
<code>model_ridge$linear.predictors</code> — linear predictors for
all observations and all lambda values,</li>
<li>
<code>model_ridge$likelihood</code> — partial log-likelihood along
the lambda path,</li>
<li>
<code>model_ridge$data</code> — the data used for fitting.</li>
</ul>
<p>The S3 method <code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef()</a></code> extracts the estimated
coefficients:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># All lambdas (columns ordered in decreasing lambda)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_ridge</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>  <span class="co"># first 5 lambdas</span></span></code></pre></div>
<pre><code><span><span class="co">##          82.0989     74.8055     68.1599     62.1048     56.5876</span></span>
<span><span class="co">## [1,]  0.03940019  0.04317345  0.04718185  0.05142086  0.05588316</span></span>
<span><span class="co">## [2,] -0.08703965 -0.09270340 -0.09863286 -0.10483116 -0.11129985</span></span>
<span><span class="co">## [3,]  0.04654658  0.05031996  0.05434817  0.05864173  0.06321089</span></span>
<span><span class="co">## [4,] -0.05680339 -0.06147303 -0.06646655 -0.07179722 -0.07747730</span></span>
<span><span class="co">## [5,]  0.10912724  0.11518227  0.12137484  0.12769148  0.13411779</span></span></code></pre>
<p>To focus on a specific value of <code>lambda</code>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lambda_target</span> <span class="op">&lt;-</span> <span class="va">model_ridge</span><span class="op">$</span><span class="va">lambda</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_ridge</span>, lambda <span class="op">=</span> <span class="va">lambda_target</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]  0.05588316 -0.11129985  0.06321089 -0.07747730  0.13411779</span></span></code></pre>
<p>If the requested lambda is not exactly one of the fitted values,
<code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef()</a></code> performs linear interpolation along the lambda
path.</p>
<p>Objects of class <code>coxkl_ridge</code> can be visualized using the
S3 plotting method <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model_ridge</span><span class="op">)</span></span></code></pre></div>
<p><img src="survkl_files/figure-html/unnamed-chunk-18-1.png" class="r-plt" alt="Plot generated in survkl vignette" width="700"></p>
<p>By default, this plots:</p>
<ul>
<li>
<strong>Loss</strong> (<code>-2 * partial log-likelihood</code>)
versus the penalty parameter <code>lambda</code>,</li>
<li>x-axis on a reversed log10 scale (larger penalties on the left,
smaller penalties on the right),</li>
<li>y-axis labeled as “Loss”.</li>
</ul>
<p>To display the C-index instead:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model_ridge</span>, criteria <span class="op">=</span> <span class="st">"CIndex"</span><span class="op">)</span></span></code></pre></div>
<p><img src="survkl_files/figure-html/unnamed-chunk-19-1.png" class="r-plt" alt="Plot generated in survkl vignette" width="700"></p>
<p>If an external test set is available, performance can be evaluated on
the test data by passing it via the <code>test_*</code> arguments:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">model_ridge</span>,</span>
<span>  test_z       <span class="op">=</span> <span class="va">test_hd</span><span class="op">$</span><span class="va">z</span>,</span>
<span>  test_time    <span class="op">=</span> <span class="va">test_hd</span><span class="op">$</span><span class="va">time</span>,</span>
<span>  test_delta   <span class="op">=</span> <span class="va">test_hd</span><span class="op">$</span><span class="va">status</span>,</span>
<span>  test_stratum <span class="op">=</span> <span class="va">test_hd</span><span class="op">$</span><span class="va">stratum</span>,</span>
<span>  criteria     <span class="op">=</span> <span class="st">"loss"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="survkl_files/figure-html/unnamed-chunk-20-1.png" class="r-plt" alt="Plot generated in survkl vignette" width="700">
The function <code>cv.coxkl_ridge</code> performs K-fold
cross-validation to tune the integration parameter <code>eta</code>
while internally scanning over a <code>lambda</code> path for each
candidate <code>eta</code>. For each <code>eta</code>, it:</p>
<ul>
<li>evaluates a sequence of ridge penalties <code>lambda</code>,</li>
<li>computes the chosen cross-validation criterion on held-out
folds,</li>
<li>selects the best <code>lambda</code> for that <code>eta</code>,</li>
<li>aggregates the results into summary tables.</li>
</ul>
<p>Supported criteria are:</p>
<ul>
<li>
<code>"V&amp;VH"</code> — V&amp;VH loss (reported as
<code>Loss = -2 * score</code>),</li>
<li>
<code>"LinPred"</code> — predicted partial deviance,</li>
<li>
<code>"CIndex_pooled"</code> — pooled C-index over all folds,</li>
<li>
<code>"CIndex_foldaverage"</code> — average C-index across
folds.</li>
</ul>
<p>Example: tuning <code>eta</code> using 5-fold cross-validation and
the <code>"V&amp;VH"</code> criterion:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">eta_grid_hd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_eta.html">generate_eta</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"exponential"</span>, n <span class="op">=</span> <span class="fl">10</span>, max_eta <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cv_ridge_hd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv.coxkl_ridge.html">cv.coxkl_ridge</a></span><span class="op">(</span></span>
<span>  z           <span class="op">=</span> <span class="va">z_hd</span>,</span>
<span>  delta       <span class="op">=</span> <span class="va">delta_hd</span>,</span>
<span>  time        <span class="op">=</span> <span class="va">time_hd</span>,</span>
<span>  stratum     <span class="op">=</span> <span class="va">strat_hd</span>,</span>
<span>  RS          <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  beta        <span class="op">=</span> <span class="va">beta_external_hd</span>,</span>
<span>  etas        <span class="op">=</span> <span class="va">eta_grid_hd</span>,</span>
<span>  nfolds      <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  cv.criteria <span class="op">=</span> <span class="st">"V&amp;VH"</span>,</span>
<span>  message     <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The best <code>lambda</code> for each <code>eta</code> (according to
the chosen criterion) is provided by:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cv_ridge_hd</span><span class="op">$</span><span class="va">integrated_stat.best_per_eta</span></span></code></pre></div>
<pre><code><span><span class="co">##           eta       lambda     Loss</span></span>
<span><span class="co">## 1    0.000000 1.025724e+02 564.3216</span></span>
<span><span class="co">## 2    0.674849 3.624675e+01 561.0502</span></span>
<span><span class="co">## 3    1.800565 5.639777e+00 555.2522</span></span>
<span><span class="co">## 4    3.678373 6.166819e-01 549.1837</span></span>
<span><span class="co">## 5    6.810744 8.639301e-03 546.4052</span></span>
<span><span class="co">## 6   12.035855 8.698543e-03 546.4233</span></span>
<span><span class="co">## 7   20.751866 8.734028e-03 547.0925</span></span>
<span><span class="co">## 8   35.291047 8.755290e-03 547.7359</span></span>
<span><span class="co">## 9   59.543864 8.768033e-03 548.2108</span></span>
<span><span class="co">## 10 100.000000 8.775671e-03 548.5282</span></span></code></pre>
<p>As with low-dimensional models, the helper function
<code><a href="../reference/cv.plot.html">cv.plot()</a></code> can be used to visualize performance versus
<code>eta</code>:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cv.plot.html">cv.plot</a></span><span class="op">(</span><span class="va">cv_ridge_hd</span><span class="op">)</span></span></code></pre></div>
<p><img src="survkl_files/figure-html/unnamed-chunk-23-1.png" class="r-plt" alt="Plot generated in survkl vignette" width="700"></p>
<p>The plot shows:</p>
<ul>
<li>a <strong>purple curve</strong> for the cross-validated performance
across the <code>eta</code> sequence (loss or C-index),</li>
<li>a <strong>green dotted horizontal line</strong> indicating the
internal baseline at <code>eta = 0</code>,</li>
<li>a <strong>green point</strong> marking the baseline value.</li>
</ul>
<p>If the purple curve dips below the green line (for loss criteria) or
rises above it (for C-index criteria), this indicates that borrowing
external information (<code>eta &gt; 0</code>) leads to improved
predictive performance.</p>
</div>
<div class="section level4">
<h4 id="elastic-net-lasso-kl-integrated-cox-model-coxkl_enet">Elastic-Net / LASSO KL-Integrated Cox Model
(<code>coxkl_enet</code>)<a class="anchor" aria-label="anchor" href="#elastic-net-lasso-kl-integrated-cox-model-coxkl_enet"></a>
</h4>
<p>The function <code>coxkl_enet</code> fits a KL-integrated Cox model
with an elastic-net penalty, controlled by the mixing parameter
<code>alpha</code>. When <code>alpha = 1</code>, the penalty reduces to
<strong>LASSO</strong>, enabling coefficient sparsity in addition to
KL-based integration of external information.</p>
<p>External knowledge may be incorporated either through external
coefficients (<code>beta</code>) or an externally computed risk score
(<code>RS</code>). The integration weight <code>eta</code> determines
how strongly the model borrows from this external signal, while the
penalty parameter <code>lambda</code> controls the sparsity level. If
<code>lambda</code> is not supplied, the function automatically
generates a decreasing lambda sequence.</p>
<p>We illustrate the workflow using <strong>LASSO</strong>
(<code>alpha = 1</code>) with an automatically generated lambda
path:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_enet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coxkl_enet.html">coxkl_enet</a></span><span class="op">(</span></span>
<span>  z        <span class="op">=</span> <span class="va">z_hd</span>,</span>
<span>  delta    <span class="op">=</span> <span class="va">delta_hd</span>,</span>
<span>  time     <span class="op">=</span> <span class="va">time_hd</span>,</span>
<span>  stratum  <span class="op">=</span> <span class="va">strat_hd</span>,</span>
<span>  RS       <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  beta     <span class="op">=</span> <span class="va">beta_external_hd</span>,   </span>
<span>  eta      <span class="op">=</span> <span class="fl">1</span>,                 </span>
<span>  alpha    <span class="op">=</span> <span class="fl">1</span>,                  <span class="co"># LASSO penalty</span></span>
<span>  lambda   <span class="op">=</span> <span class="cn">NULL</span>,              </span>
<span>  message  <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## External beta information is used.</span></span></code></pre>
<p>The fitted object stores, for each lambda value:</p>
<ul>
<li>
<code>model_enet$lambda</code> — the lambda sequence (in decreasing
order),</li>
<li>
<code>model_enet$beta</code> — estimated coefficients (one column
per lambda),</li>
<li>
<code>model_enet$likelihood</code> — partial log-likelihood along
the lambda path,</li>
<li>
<code>model_enet$data</code> — the data used for fitting.</li>
</ul>
<p>The S3 method <code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef()</a></code> extracts the estimated
coefficients:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_enet</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##    0.0853     0.0796     0.0742     0.0692     0.0645</span></span>
<span><span class="co">## Z1      0 0.00000000 0.00000000 0.00000000 0.00000000</span></span>
<span><span class="co">## Z2      0 0.00000000 0.00000000 0.00000000 0.00000000</span></span>
<span><span class="co">## Z3      0 0.00000000 0.00000000 0.00000000 0.00000000</span></span>
<span><span class="co">## Z4      0 0.00000000 0.00000000 0.00000000 0.00000000</span></span>
<span><span class="co">## Z5      0 0.01945713 0.03849402 0.05620049 0.07282693</span></span></code></pre>
<p>To extract coefficients corresponding to a specific
<code>lambda</code>:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lambda_target</span> <span class="op">&lt;-</span> <span class="va">model_enet</span><span class="op">$</span><span class="va">lambda</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_enet</span>, lambda <span class="op">=</span> <span class="va">lambda_target</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.00000000 0.00000000 0.00000000 0.00000000 0.07282693</span></span></code></pre>
<p>Similar, if the requested lambda is not exactly one of the fitted
values, <code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef()</a></code> performs linear interpolation along the
lambda path.</p>
<p>Objects of class <code>coxkl_enet</code> can be visualized using the
S3 method <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>, and default is to plot loss versus
<code>lambda</code>:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model_enet</span><span class="op">)</span></span></code></pre></div>
<p><img src="survkl_files/figure-html/unnamed-chunk-27-1.png" class="r-plt" alt="Plot generated in survkl vignette" width="700"></p>
<p>When a test dataset is available, performance can be assessed on
held-out data:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">model_enet</span>,</span>
<span>  test_z <span class="op">=</span> <span class="va">test_hd</span><span class="op">$</span><span class="va">z</span>,</span>
<span>  test_time <span class="op">=</span> <span class="va">test_hd</span><span class="op">$</span><span class="va">time</span>,</span>
<span>  test_delta <span class="op">=</span> <span class="va">test_hd</span><span class="op">$</span><span class="va">status</span>,</span>
<span>  test_stratum <span class="op">=</span> <span class="va">test_hd</span><span class="op">$</span><span class="va">stratum</span>,</span>
<span>  criteria <span class="op">=</span> <span class="st">"loss"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="survkl_files/figure-html/unnamed-chunk-28-1.png" class="r-plt" alt="Plot generated in survkl vignette" width="700">
Similar, the function <code>cv.coxkl_enet</code> extends the above
fitting procedure by performing K-fold cross-validation over a supplied
grid of eta values:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">eta_grid_hd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_eta.html">generate_eta</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>                            n <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                            max_eta <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cv_enet_hd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv.coxkl_enet.html">cv.coxkl_enet</a></span><span class="op">(</span></span>
<span>  z <span class="op">=</span> <span class="va">z_hd</span>,</span>
<span>  delta <span class="op">=</span> <span class="va">delta_hd</span>,</span>
<span>  time <span class="op">=</span> <span class="va">time_hd</span>,</span>
<span>  stratum <span class="op">=</span> <span class="va">strat_hd</span>,</span>
<span>  RS <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  beta <span class="op">=</span> <span class="va">beta_external_hd</span>,</span>
<span>  etas <span class="op">=</span> <span class="va">eta_grid_hd</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">1</span>, <span class="co"># LASSO</span></span>
<span>  nfolds <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  cv.criteria <span class="op">=</span> <span class="st">"V&amp;VH"</span>,</span>
<span>  message <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>CV results can be visualized using <code><a href="../reference/cv.plot.html">cv.plot()</a></code>:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cv.plot.html">cv.plot</a></span><span class="op">(</span><span class="va">cv_enet_hd</span><span class="op">)</span></span></code></pre></div>
<p><img src="survkl_files/figure-html/unnamed-chunk-30-1.png" class="r-plt" alt="Plot generated in survkl vignette" width="700"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Yubo Shao, Lingfeng Luo, Junyi Qiu, Xiaohan Liu, Di Wang, Kevin He.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
