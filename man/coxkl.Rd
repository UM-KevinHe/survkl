% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/coxkl.R
\name{coxkl}
\alias{coxkl}
\title{Cox Proportional Hazards Model with KL Divergence for Data Integration}
\usage{
coxkl(
  z,
  delta,
  time,
  stratum = NULL,
  RS = NULL,
  beta = NULL,
  etas,
  tol = 1e-04,
  Mstop = 100,
  backtrack = FALSE,
  message = FALSE,
  data_sorted = FALSE,
  beta_initial = NULL
)
}
\arguments{
\item{z}{Numeric matrix of covariates with rows representing observations and
columns representing predictor variables. All covariates must be numeric.}

\item{delta}{Numeric vector of event indicators (1 = event, 0 = censored).}

\item{time}{Numeric vector of observed event or censoring times. No sorting
required.}

\item{stratum}{Optional numeric or factor vector defining strata.}

\item{RS}{Optional numeric vector or matrix of external risk scores. Length
(or number of rows) must equal the number of observations. If not supplied,
\code{beta} must be provided.}

\item{beta}{Optional numeric vector of external coefficients (e.g., from prior
studies). Length must equal the number of columns in \code{z}. Use zeros to
represent covariates without external information. If not supplied, \code{RS}
must be provided.}

\item{etas}{Numeric vector of tuning parameters controlling the reliance on
external information. Larger values place more weight on the external
source.}

\item{tol}{Convergence tolerance for the optimization algorithm. Default is
\code{1e-4}.}

\item{Mstop}{Maximum number of iterations for the optimization algorithm.
Default is \code{100}.}

\item{backtrack}{Logical; if \code{TRUE}, backtracking line search is applied during
optimization. Default is \code{FALSE}.}

\item{message}{Logical; if \code{TRUE}, progress messages are printed during model
fitting. Default is \code{FALSE}.}

\item{data_sorted}{Logical; if \code{TRUE}, input data are assumed to be already
sorted by stratum and time. Default is \code{FALSE}.}

\item{beta_initial}{Optional numeric vector of length \code{p} giving the starting
value for the first \code{eta}. If \code{NULL}, a zero vector is used.}
}
\value{
An object of class \code{"coxkl"} containing:
\itemize{
\item \code{eta}: the fitted \eqn{\eta} sequence.
\item \code{beta}: estimated coefficient matrix (\eqn{p \times |\eta|}).
\item \code{linear.predictors}: matrix of linear predictors.
\item \code{likelihood}: vector of partial likelihoods.
\item \code{data}: a list containing the input data used in fitting
(\code{z}, \code{time}, \code{delta}, \code{stratum}, \code{data_sorted}).
}
}
\description{
Fits a Cox proportional hazards model that incorporates external information
via a Kullbackâ€“Leibler (KL) divergence penalty. External information can be
supplied either as external risk scores (\code{RS}) or as external coefficients
(\code{beta}). The tuning parameter(s) \code{etas} control the strength of integration.
}
\details{
If \code{beta} is supplied (length \code{ncol(z)}), external risk scores are computed
internally as \code{RS = z \%*\% beta}. If \code{RS} is supplied, it is used directly.
Data are optionally sorted by \code{stratum} (or a single stratum if \code{NULL}) and
increasing \code{time} when \code{data_sorted = FALSE}. Estimation proceeds over the
sorted data, and the returned \code{linear.predictors} are mapped back to the
original order. Optimization uses warm starts across the (ascending) \code{etas}
grid and supports backtracking line search when \code{backtrack = TRUE}.

Internally, the routine computes a stratum-wise adjusted event indicator
(\code{delta_tilde}) and maximizes a KL-regularized partial likelihood. The current
implementation fixes \code{lambda = 0} in the low-level optimizer and exposes
\code{etas} as the primary tuning control.
}
\examples{
data(Exampledata_lowdim)

train_dat_lowdim <- ExampleData_lowdim$train
beta_external_good_lowdim <- ExampleData_lowdim$beta_external_good

model <- coxkl(z = train_dat_lowdim$z,
     delta = train_dat_lowdim$status,
     time = train_dat_lowdim$time,
     stratum = train_dat_lowdim$stratum,
     RS = NULL,
     beta = beta_external_good_lowdim,
     etas = c(0:5))

}
