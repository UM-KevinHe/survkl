% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cv.coxkl_ridge.R
\name{cv.coxkl_ridge}
\alias{cv.coxkl_ridge}
\title{Cross-Validation for CoxKL Ridge Model (eta tuning)}
\usage{
cv.coxkl_ridge(
  z,
  delta,
  time,
  stratum = NULL,
  RS = NULL,
  beta = NULL,
  etas,
  lambda = NULL,
  nlambda = 100,
  lambda.min.ratio = ifelse(n_obs < n_vars, 0.01, 1e-04),
  nfolds = 5,
  cv.criteria = c("V&VH", "LinPred", "CIndex_pooled", "CIndex_foldaverage"),
  c_index_stratum = NULL,
  message = FALSE,
  seed = NULL,
  ...
)
}
\arguments{
\item{z}{Numeric matrix of covariates with rows representing individuals and
columns representing predictors.}

\item{delta}{Numeric vector of event indicators (1 = event, 0 = censored).}

\item{time}{Numeric vector of observed times (event or censoring).}

\item{stratum}{Optional factor or numeric vector indicating strata.}

\item{RS}{Optional numeric vector or matrix of external risk scores. If not provided,
\code{beta} must be supplied.}

\item{beta}{Optional numeric vector of external coefficients (length equal to
\code{ncol(z)}). If not provided, \code{RS} must be supplied.}

\item{etas}{Numeric vector of candidate \code{eta} values to be evaluated.}

\item{lambda}{Optional numeric scalar or vector of penalty parameters. If \code{NULL}, a sequence is generated automatically.}

\item{nlambda}{Integer number of lambda values to generate when \code{lambda} is \code{NULL}. Default \code{100}.}

\item{lambda.min.ratio}{Ratio of the smallest to the largest lambda when generating a sequence
(when \code{lambda} is \code{NULL}). Default \code{0.01} when \code{n < p}, otherwise \code{1e-4}.}

\item{nfolds}{Integer; number of cross-validation folds. Default \code{5}.}

\item{cv.criteria}{Character string specifying the cross-validation criterion. Choices are:
\itemize{
\item \code{"V&VH"} (default): \code{"V&VH"} loss.
\item \code{"LinPred"}: loss based on cross-validated linear predictors.
\item \code{"CIndex_pooled"}: pool all held-out predictions and compute one overall C-index.
\item \code{"CIndex_foldaverage"}: average C-index across folds.
}}

\item{c_index_stratum}{Optional stratum vector. Used only when
\code{cv.criteria} is \code{"CIndex_pooled"} or \code{"CIndex_foldaverage"} to compute a stratified C-index
for a non-stratified fit; if supplied, it must be identical to \code{stratum}. Default \code{NULL}.}

\item{message}{Logical; whether to print progress messages. Default \code{FALSE}.}

\item{seed}{Optional integer random seed for fold assignment.}

\item{...}{Additional arguments passed to \code{\link{coxkl_ridge}}.}
}
\value{
An object of class \code{"cv.coxkl_ridge"}:
\describe{
\item{\code{integrated_stat.full_results}}{Data frame with columns \code{eta}, \code{lambda}, and the aggregated CV score per \code{lambda};
for loss criteria an additional column \code{Loss = -2 * score}; for C-index criteria a column named \code{CIndex_pooled} or \code{CIndex_foldaverage}.}
\item{\code{integrated_stat.best_per_eta}}{Data frame with the best \code{lambda} (per \code{eta}) according to the chosen criterion.}
\item{\code{external_stat}}{Scalar baseline statistic computed from \code{RS} under the same \code{cv.criteria}.}
\item{\code{criteria}}{The evaluation criterion used.}
\item{\code{nfolds}}{Number of folds.}
}
}
\description{
This function performs cross-validation on the Cox model with Kullbackâ€“Leibler (KL)
penalty and ridge (L2) regularization. It tunes the parameter \code{eta}
(external information weight) using user-specified cross-validation criteria,
while internally evaluating a \code{lambda} path (provided or generated) and
selecting the best \code{lambda} per \code{eta}
}
\details{
Data are sorted by \code{stratum} and \code{time}. External information must be given via \code{RS}
or \code{beta} (if \code{beta} has length \code{ncol(z)}, the function computes \code{RS = z \%*\% beta}).
For each candidate \code{eta}, a \code{lambda} path is determined (generated if \code{lambda = NULL}, otherwise
the supplied \code{lambda} values are sorted decreasingly). Cross-validation folds are created by \code{get_fold}.
In each fold, \code{\link{coxkl_ridge}} is fit on the training split across the full \code{lambda} path
with \code{data_sorted = TRUE}, and the chosen criterion is evaluated on the test split and aggregated:
\itemize{
\item \code{"V&VH"}: sums \code{pl(full) - pl(train)} across folds (reported as loss via \code{Loss = -2 * score}).
\item \code{"LinPred"}: aggregates test-fold linear predictors and evaluates partial log-likelihood on full data (reported as \code{Loss = -2 * score}).
\item \code{"CIndex_pooled"}: pools comparable-pair numerators/denominators across folds to compute one C-index.
\item \code{"CIndex_foldaverage"}: averages the per-fold stratified C-index.
}
The best \code{lambda} is chosen per \code{eta} (minimizing loss or maximizing C-index). The function
also computes an external baseline statistic from \code{RS} under the same criterion.
}
\examples{
\donttest{
data(ExampleData_highdim) 

train_dat_highdim <- ExampleData_highdim$train
beta_external_highdim <- ExampleData_highdim$beta_external

etas <- generate_eta(method = "exponential", n = 10, max_eta = 100)
cv_res <- cv.coxkl_ridge(z = train_dat_highdim$z,
                         delta = train_dat_highdim$status,
                         time = train_dat_highdim$time,
                         beta = beta_external_highdim,
                         etas = etas)
}
}
